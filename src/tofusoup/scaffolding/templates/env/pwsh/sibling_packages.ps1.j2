# --- Sibling Packages ---
Write-Header "🤝 Installing Sibling Packages"

$ParentDir = Split-Path -Parent (Get-Location)
$SiblingCount = 0

{% for sibling_pattern in sibling_patterns %}
Get-ChildItem -Path $ParentDir -Directory -Filter "{{ sibling_pattern }}" | ForEach-Object {
    $SiblingName = $_.Name
    Write-Host "Installing $SiblingName..." -NoNewline
    try {
        {% if create_log_dir %}
        & uv pip install --no-deps -e $_.FullName 2>&1 | Out-File -FilePath (Join-Path $LogDir "$SiblingName.log")
        {% else %}
        & uv pip install --no-deps -e $_.FullName
        {% endif %}
        Write-Success " $SiblingName installed"
        $SiblingCount++
    }
    catch {
        Write-Warning " Failed to install $SiblingName"
    }
}
{% endfor %}

{% if special_siblings %}
# Special handling for specific packages
{% for special in special_siblings %}
${{ special.var_name }}Dir = Join-Path $ParentDir "{{ special.name }}"
if (Test-Path ${{ special.var_name }}Dir) {
    Write-Host "Found {{ special.name }} package. Installing in editable mode{{ ' with dependencies' if special.with_deps else '' }}..." -NoNewline
    try {
        {% if special.with_deps %}
        & uv pip install -e ${{ special.var_name }}Dir
        {% else %}
        & uv pip install --no-deps -e ${{ special.var_name }}Dir
        {% endif %}
        Write-Success " {{ special.name }} installed"
    }
    catch {
        Write-Warning " Failed to install {{ special.name }} package from '${{ special.var_name }}Dir'"
        Write-Host "Attempting to continue..."
    }
}
{% endfor %}
{% endif %}

if ($SiblingCount -eq 0) {
    Write-Warning "No sibling packages found"
}