# --- Sibling Packages ---
print_header "🤝 Installing Sibling Packages"

PARENT_DIR=$(dirname "$(pwd)")
SIBLING_COUNT=0

{% for sibling_pattern in sibling_patterns %}
for dir in "${PARENT_DIR}"/{{ sibling_pattern }}; do
    if [ -d "${dir}" ]; then
        SIBLING_NAME=$(basename "${dir}")
        echo -n "Installing ${SIBLING_NAME}..."
        {% if use_spinner %}
        uv pip install --no-deps -e "${dir}" > /tmp/{{ project_name }}_setup/${SIBLING_NAME}.log 2>&1 &
        spinner $!
        {% else %}
        uv pip install --no-deps -e "${dir}"
        {% endif %}
        print_success "${SIBLING_NAME} installed"
        ((SIBLING_COUNT++))
    fi
done
{% endfor %}

{% if special_siblings %}
# Special handling for specific packages
{% for special in special_siblings %}
{{ special.var_name }}_DIR="${PARENT_DIR}/{{ special.name }}"
if [ -d "${{{ special.var_name }}_DIR}" ]; then
    echo "Found {{ special.name }} package. Installing in editable mode{{ ' with dependencies' if special.with_deps else '' }}..."
    {% if special.with_deps %}
    if ! uv pip install -e "${{{ special.var_name }}_DIR}"; then
    {% else %}
    if ! uv pip install --no-deps -e "${{{ special.var_name }}_DIR}"; then
    {% endif %}
        print_warning "Failed to install {{ special.name }} package from '${{{ special.var_name }}_DIR}' in editable mode."
        echo "Attempting to continue..."
    fi
fi
{% endfor %}
{% endif %}

if [ $SIBLING_COUNT -eq 0 ]; then
    print_warning "No sibling packages found"
fi